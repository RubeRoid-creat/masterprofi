# Order Details Screen

Полнофункциональный экран деталей заказа для мастеров сервиса со всеми необходимыми инструментами для работы с заказом.

## Особенности

✅ **Status Timeline** - Временная линия статусов заказа  
✅ **Client Contact** - Контактная информация с кнопками звонка и сообщения  
✅ **Appliance Details** - Детали прибора и симптомы проблемы  
✅ **Photo Gallery** - Галерея фотографий проблем с возможностью добавления  
✅ **Cost Calculator** - Калькулятор стоимости ремонта  
✅ **Parts Catalog** - Выбор запчастей из каталога  
✅ **Chat** - Чат с клиентом в реальном времени  
✅ **Navigation** - Интеграция с навигационными приложениями  
✅ **Work Timer** - Таймер начала/окончания работы  
✅ **Digital Signature** - Захват цифровой подписи  

## Компоненты

### OrderDetailsScreen
Главный компонент экрана, объединяющий все функциональные блоки.

### StatusTimeline
Визуализация истории изменения статусов заказа с временными метками.

### ClientInfo
Блок с информацией о клиенте:
- Аватар и имя
- Номер телефона
- Кнопки звонка и сообщения

### ApplianceDetails
Детальная информация о приборе:
- Тип, марка, модель
- Описание проблемы
- Симптомы (теги)
- Дополнительные заметки

### PhotoGallery
Галерея фотографий:
- Просмотр фотографий проблем
- Добавление новых фотографий
- Удаление фотографий
- Полноэкранный просмотр

### PartsCatalog
Каталог запчастей:
- Поиск по названию и номеру
- Фильтрация по категориям
- Добавление в список выбранных
- Управление количеством
- Отображение наличия

### CostCalculator
Калькулятор стоимости:
- Стоимость работы (labor)
- Стоимость запчастей (автоматически)
- Сервисный сбор
- Скидка (фиксированная или процентная)
- Итоговая стоимость

### ChatComponent
Чат с клиентом:
- Обмен сообщениями
- Отправка изображений
- Отображение статусов сообщений
- Автопрокрутка к новым сообщениям

### WorkTimer
Таймер работы:
- Старт/стоп работы
- Отображение времени в формате MM:SS или HH:MM:SS
- Учет перерывов
- Автоматический расчет общего времени

### SignatureCapture
Захват подписи:
- Клиентская подпись (обязательно при завершении)
- Подпись мастера (опционально)
- Очистка и сохранение

### NavigationButton
Интеграция с навигацией:
- Открытие в Google Maps / Apple Maps
- Fallback на веб-версию карт

## Использование

```tsx
import { OrderDetailsScreen } from './src/screens/OrderDetailsScreen';

function App() {
  const handleStatusChange = (orderId: string, status: OrderStatus) => {
    // Обновление статуса заказа
    console.log(`Order ${orderId} status changed to ${status}`);
  };

  return (
    <OrderDetailsScreen
      orderId="123"
      onStatusChange={handleStatusChange}
    />
  );
}
```

## Интеграция

### API Endpoints
- `GET /api/orders/:id` - Получение деталей заказа
- `PATCH /api/orders/:id/status` - Обновление статуса
- `POST /api/orders/:id/parts` - Добавление запчастей
- `POST /api/orders/:id/chat` - Отправка сообщения
- `POST /api/orders/:id/signature` - Сохранение подписи

### WebSocket Events
- `order_update` - Обновление заказа в реальном времени
- `chat_message` - Новое сообщение в чате

## Зависимости

```bash
npm install react-native-svg
```

Для полной функциональности подписи рекомендуется установить:
```bash
npm install react-native-signature-capture
```

## Функциональность

### Статусы заказа
- `new` - Новый заказ
- `assigned` - Назначен мастеру
- `in_progress` - В работе
- `completed` - Завершен
- `cancelled` - Отменен

### Управление временем
- Автоматический подсчет рабочего времени
- Учет перерывов
- Сохранение времени начала и окончания

### Расчет стоимости
- Автоматический расчет на основе запчастей
- Ручной ввод стоимости работы
- Применение скидок (процент или фиксированная сумма)
- Детальная разбивка стоимости

### Чат
- Синхронизация сообщений в реальном времени
- Отправка фотографий
- История сообщений
- Индикаторы статуса

### Навигация
- Определение текущего местоположения
- Построение маршрута до адреса клиента
- Открытие в нативных приложениях карт

## Типы данных

```typescript
interface OrderDetails extends Order {
  statusTimeline: OrderStatusEvent[];
  photos: string[];
  symptoms: string[];
  parts: Part[];
  costBreakdown: CostBreakdown;
  workTimer: WorkTimer;
  chatMessages: ChatMessage[];
  signature: {
    clientSignature?: string;
    masterSignature?: string;
  };
}
```

## Производительность

- Ленивая загрузка изображений
- Оптимизированное отображение списков
- Кэширование данных заказа
- Оптимизация перерисовок компонентов









