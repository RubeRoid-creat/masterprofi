# üîÑ –û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ –º–µ–∂–¥—É –º–æ–±–∏–ª—å–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å—é

## üì° –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏

### –û–±—â–∏–π Backend API
–û–±–∞ –∫–ª–∏–µ–Ω—Ç–∞ (–º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å) –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ NestJS backend API:

- **URL**: `http://localhost:3000/api` (development)
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: `http://localhost:3000/api/docs` (Swagger)
- **Base Path**: `/api`

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤

#### –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (`mobile-app`)
```typescript
// mobile-app/src/config/environments.ts
apiUrl: 'http://localhost:3000/api'
```

#### –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (`web-admin`)
```typescript
// web-admin/src/services/api.ts
baseURL: '/api' // –ü—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ Vite ‚Üí http://localhost:3000/api
```

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### –û–±—â–∏–π –º–µ—Ö–∞–Ω–∏–∑–º
- **JWT —Ç–æ–∫–µ–Ω—ã** –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer <token>`
- **Cookie-based** –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **–¢–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è**:
  - Mobile: `AsyncStorage` ‚Üí `auth_token`
  - Web Admin: `localStorage` ‚Üí `token`

### Endpoints
- `POST /api/auth/login` - –í—Ö–æ–¥
- `POST /api/auth/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /api/auth/refresh` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- `GET /api/auth/me` - –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

## üìä –û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ

### 1. –ó–∞–∫–∞–∑—ã (Orders)

#### Endpoints
- `GET /api/orders` - –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ (—Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏)
- `GET /api/orders/:id` - –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
- `POST /api/orders/:id/accept` - –ü—Ä–∏–Ω—è—Ç—å –∑–∞–∫–∞–∑
- `PATCH /api/orders/:id/status` - –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å
- `POST /api/orders/:id/messages` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
- `POST /api/orders/:id/photos` - –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- **Mobile**: –ú–∞—Å—Ç–µ—Ä–∞ –≤–∏–¥—è—Ç –∑–∞–∫–∞–∑—ã, –ø—Ä–∏–Ω–∏–º–∞—é—Ç, –æ–±–Ω–æ–≤–ª—è—é—Ç —Å—Ç–∞—Ç—É—Å
- **Admin**: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –≤–∏–¥—è—Ç –≤—Å–µ –∑–∞–∫–∞–∑—ã, —É–ø—Ä–∞–≤–ª—è—é—Ç —Å—Ç–∞—Ç—É—Å–∞–º–∏

### 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (Users)

#### Endpoints
- `GET /api/users` - –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `GET /api/users/:id` - –î–µ—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `PATCH /api/users/:id` - –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `DELETE /api/users/:id` - –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- **Mobile**: –ú–∞—Å—Ç–µ—Ä–∞ –≤–∏–¥—è—Ç —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å, –∫–ª–∏–µ–Ω—Ç–æ–≤
- **Admin**: –ü–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### 3. MLM –°–µ—Ç—å (Network)

#### Endpoints
- `GET /api/mlm/network` - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ç–∏
- `GET /api/mlm/commissions` - –ö–æ–º–∏—Å—Å–∏–∏
- `GET /api/mlm/team-stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã
- `POST /api/mlm/invite` - –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- **Mobile**: –ú–∞—Å—Ç–µ—Ä–∞ –≤–∏–¥—è—Ç —Å–≤–æ—é —Å–µ—Ç—å, –∫–æ–º–∏—Å—Å–∏–∏, –ø—Ä–∏–≥–ª–∞—à–∞—é—Ç
- **Admin**: –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ–π MLM —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### 4. –î–æ—Ö–æ–¥—ã (Earnings)

#### Endpoints
- `GET /api/earnings/balance` - –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
- `GET /api/earnings/history` - –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
- `POST /api/earnings/withdraw` - –ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥
- `GET /api/earnings/breakdown` - –†–∞–∑–±–∏–≤–∫–∞ –¥–æ—Ö–æ–¥–æ–≤

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- **Mobile**: –ú–∞—Å—Ç–µ—Ä–∞ –≤–∏–¥—è—Ç —Å–≤–æ–∏ –¥–æ—Ö–æ–¥—ã, –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç –≤—ã–≤–æ–¥
- **Admin**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–ª–∞—Ç–∞–º–∏, –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

## üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (WebSocket)

#### Chat Gateway
- `ws://localhost:3000` - WebSocket –¥–ª—è —á–∞—Ç–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∑–∞–∫–∞–∑–∞—Ö
- **Mobile**: `useChatWebSocket` hook
- **Admin**: Socket.IO client

#### Notification Gateway
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–∞—Ö, —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- Push notifications –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### Polling (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- Mobile app: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
- Admin panel: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ

## üìù –û–±—â–∏–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å shared —Ç–∏–ø—ã:
```
shared-types/
  ‚îú‚îÄ‚îÄ order.types.ts
  ‚îú‚îÄ‚îÄ user.types.ts
  ‚îú‚îÄ‚îÄ mlm.types.ts
  ‚îî‚îÄ‚îÄ earnings.types.ts
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TypeScript path mapping –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤ –∏–∑ backend.

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### 1. –ó–∞–ø—É—Å–∫ Backend
```bash
cd backend
npm run start:dev
# Backend –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://localhost:3000
```

### 2. –ó–∞–ø—É—Å–∫ Mobile App
```bash
cd mobile-app
npx expo start --web
# Mobile app –∏—Å–ø–æ–ª—å–∑—É–µ—Ç http://localhost:3000/api
```

### 3. –ó–∞–ø—É—Å–∫ Admin Panel
```bash
cd web-admin
npm run dev
# Admin panel –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–∫—Å–∏ /api ‚Üí http://localhost:3000/api
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏

### –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã

#### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ API –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
```bash
curl http://localhost:3000/api/docs
```

#### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ CORS
```bash
curl -H "Origin: http://localhost:19006" \
     -H "Access-Control-Request-Method: GET" \
     -H "Access-Control-Request-Headers: Authorization" \
     -X OPTIONS \
     http://localhost:3000/api/orders
```

#### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
```bash
# –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"emailOrPhone":"test@example.com","password":"123456"}'

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω
curl http://localhost:3000/api/orders \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## üì± –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π

### Mobile App ‚Üí Admin Panel
- –ö–æ–≥–¥–∞ –º–∞—Å—Ç–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–∫–∞–∑ ‚Üí —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- –ö–æ–≥–¥–∞ –º–∞—Å—Ç–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —á–∞—Ç–µ –∑–∞–∫–∞–∑–∞
- –ö–æ–≥–¥–∞ –º–∞—Å—Ç–µ—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–∏–¥–Ω—ã –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

### Admin Panel ‚Üí Mobile App
- –ö–æ–≥–¥–∞ –∞–¥–º–∏–Ω —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑ ‚Üí –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- –ö–æ–≥–¥–∞ –∞–¥–º–∏–Ω –∏–∑–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- –ö–æ–≥–¥–∞ –∞–¥–º–∏–Ω –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –º–∞—Å—Ç–µ—Ä–∞ ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

## üöÄ Production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Environment Variables

#### Mobile App
```env
EXPO_PUBLIC_API_URL_PROD=https://api.masterprofi.com/api
EXPO_PUBLIC_WS_URL_PROD=wss://api.masterprofi.com
```

#### Web Admin
```env
VITE_API_URL=https://api.masterprofi.com/api
```

#### Backend
```env
FRONTEND_URL=https://admin.masterprofi.com
CORS_ORIGINS=https://admin.masterprofi.com,https://app.masterprofi.com
```

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- [x] Backend API –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –æ–±–æ–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- [x] JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Mobile app –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API URL
- [x] Web admin –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API URL
- [ ] Shared —Ç–∏–ø—ã —Å–æ–∑–¥–∞–Ω—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] WebSocket —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: CORS –æ—à–∏–±–∫–∏
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `backend/src/main.ts` - –¥–æ–±–∞–≤—å—Ç–µ origin –≤ `allowedOrigins`

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–æ–∫–µ–Ω—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <token>` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞: –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ polling –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã








